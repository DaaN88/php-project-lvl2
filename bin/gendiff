#!/usr/bin/env php
<?php

use function Gendiff\data\dataForGendiff\getReference;
use function Gendiff\Engine\genDiff\genDiff;

// Путь который будет использован при глобальной установке пакета
$autoloadGlobalPath = __DIR__ . '/../../../autoload.php';
// Путь для локальной работы с проектом
$autoloadLocalPath = __DIR__ . '/../vendor/autoload.php';

if (file_exists($autoloadGlobalPath)) {
    require_once $autoloadGlobalPath;
} else {
    require_once $autoloadLocalPath;
}

$doc = getReference();

$params = [
  'argv'=>array_slice($_SERVER['argv'], 1),
  'help' => true,
  'version' => 'Generate diff',
  'optionsFirst' => false,
];

$result = Docopt::handle($doc, $params);

$pathBeforeFile = $result->args['<firstFile>'];
$pathAfterFile = $result->args['<secondFile>'];
$format = $result->args['--format'];

try {
    echo(genDiff($pathBeforeFile, $pathAfterFile, $format));
} catch (\RuntimeException $message) {
    echo $message->getMessage();
    exit();
}
